{% extends 'jogos/base.html' %}

{% block title %}Ranking Individual - {{ ano }}{% endblock %}

{% block content %}
<h2>üìä Ranking Individual - {{ ano }}{% if trimestre %} - {{ trimestre }}¬∫ Trimestre{% endif %}</h2>

<div class="filters">
    <form method="get">
        <label for="trimestre">Filtrar por trimestre:</label>
        <select name="trimestre" id="trimestre">
            <option value="">Todos os trimestres</option>
            {% for trim in trimestres %}
                <option value="{{ trim.valor }}" {% if trimestre == trim.valor %}selected{% endif %}>
                    {{ trim.nome }}
                </option>
            {% endfor %}
        </select>
        
        <label for="min_partidas">Partidas m√≠nimas:</label>
        <input type="number" name="min_partidas" id="min_partidas" 
               value="{{ partidas_minimas }}" min="1" max="50">
        
        <button type="submit">Aplicar Filtros</button>
    </form>
</div>

{% if ranking %}
    <div style="margin-bottom: 20px;">
        <p><strong>Total de jogadores:</strong> {{ ranking|length }}</p>
        <p><strong>Crit√©rio de ordena√ß√£o:</strong> Efici√™ncia e depois m√©dia de pontos</p>
    </div>

    <table>
        <thead>
            <tr>
                <th>Posi√ß√£o</th>
                <th>Jogador</th>
                <th>Partidas</th>
                <th>Pontos</th>
                <th>Vit√≥rias</th>
                <th>M√©dia de Pontos</th>
                <th>Efici√™ncia (%)</th>
                <th>Capotinhos Dados</th>
                <th>Capotinhos Tomados</th>
            </tr>
        </thead>
        <tbody>
            {% for item in ranking %}
            <tr>
                <td class="rank-position">{{ forloop.counter }}¬∫</td>
                <td><strong>{{ item.jogador }}</strong></td>
                <td>{{ item.partidas }}</td>
                <td>{{ item.pontos }}</td>
                <td>{{ item.vitorias }}</td>
                <td>{{ item.media_pontos|floatformat:2 }}</td>
                <td class="{% if item.eficiencia >= 70 %}efficiency-high{% elif item.eficiencia >= 50 %}efficiency-medium{% else %}efficiency-low{% endif %}">
                    {{ item.eficiencia|floatformat:1 }}%
                </td>
                <td style="color: #27ae60; font-weight: bold;">{{ item.capotinhos_dados }}</td>
                <td style="color: #e74c3c; font-weight: bold;">{{ item.capotinhos_tomados }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <div style="text-align: center; padding: 40px;">
        <h3>üì≠ Nenhum jogador encontrado</h3>
        <p>N√£o h√° jogadores que atendam aos crit√©rios de filtro selecionados.</p>
        <p>Tente reduzir o n√∫mero m√≠nimo de partidas ou alterar o per√≠odo.</p>
    </div>
{% endif %}

<div style="margin-top: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 5px;">
    <h4>‚ÑπÔ∏è Informa√ß√µes sobre o Ranking</h4>
    <ul>
        <li><strong>Efici√™ncia:</strong> Percentual de vit√≥rias em rela√ß√£o ao total de partidas</li>
        <li><strong>M√©dia de Pontos:</strong> Pontos totais divididos pelo n√∫mero de partidas</li>
        <li><strong>Ordena√ß√£o:</strong> Primeiro por efici√™ncia, depois por m√©dia de pontos</li>
        <li><strong>Cores da Efici√™ncia:</strong> 
            <span class="efficiency-high">Verde ‚â• 70%</span>, 
            <span class="efficiency-medium">Laranja ‚â• 50%</span>, 
            <span class="efficiency-low">Vermelho < 50%</span>
        </li>
    </ul>
</div>
{% endblock %}
